---
[INFRA-001]  Initialize monorepo with Turborepo
Date: 2026-02-20
What was done:
- Created Turborepo monorepo scaffolding at the repository root.
- Added root workspace configuration and stub package scripts for backend, web, and extension workspaces.
- Added repository baseline config files (.editorconfig and .gitignore).
- Marked INFRA-001 as passed in prd.json.
Key decisions / gotchas:
- Used minimal stub build/lint/test scripts per workspace so turbo pipelines execute before full app scaffolding.
- Kept backend as a placeholder workspace package for Turborepo orchestration; Python service setup is deferred to INFRA-003.
Files created/modified: package.json, turbo.json, .editorconfig, .gitignore, packages/backend/package.json, packages/web/package.json, packages/extension/package.json, prd.json, progress.txt
---
---
[INFRA-002]  Docker Compose dev environment
Date: 2026-02-20
What was done:
- Added `docker-compose.dev.yml` with MySQL 8.0, MinIO, and Redis services for local development.
- Added health checks for MySQL (`mysqladmin ping`), MinIO (`/minio/health/live`), and Redis (`redis-cli ping`).
- Added `.env.example` documenting all environment variables consumed by `docker-compose.dev.yml`.
- Marked story INFRA-002 as passed in `prd.json`.
Key decisions / gotchas:
- Added dedicated MySQL health check credentials (`MYSQL_HEALTHCHECK_USER`/`MYSQL_HEALTHCHECK_PASSWORD`) so health checks are explicit and configurable.
- Pinned MinIO image to a dated release tag for deterministic local environments.
Files created/modified: docker-compose.dev.yml, .env.example, prd.json, progress.txt
---
---
[INFRA-003]  FastAPI backend skeleton with SQLAlchemy async + Alembic
Date: 2026-02-20
What was done:
- Added a Python backend project scaffold in `packages/backend` with pinned dependencies in `pyproject.toml`.
- Implemented `packages/backend/app/main.py` with FastAPI app bootstrap and a `GET /health` endpoint returning `{"status":"ok"}`.
- Added environment-driven settings via `pydantic-settings` and async SQLAlchemy engine/session wiring.
- Configured Alembic for async migrations (`alembic.ini`, async `alembic/env.py`) and added a baseline revision file.
- Marked `INFRA-003` as passed in `prd.json`.
Key decisions / gotchas:
- Kept the first Alembic revision as a no-op baseline so `alembic upgrade head` can initialize cleanly before schema stories (`DB-*`) introduce tables.
- Read MySQL connection values from environment to align with the existing Docker dev stack variables from `.env.example`.
Files created/modified: packages/backend/pyproject.toml, packages/backend/app/__init__.py, packages/backend/app/main.py, packages/backend/app/core/__init__.py, packages/backend/app/core/settings.py, packages/backend/app/db/__init__.py, packages/backend/app/db/base.py, packages/backend/app/db/session.py, packages/backend/alembic.ini, packages/backend/alembic/env.py, packages/backend/alembic/script.py.mako, packages/backend/alembic/versions/0001_backend_skeleton.py, prd.json, progress.txt
---
---
[INFRA-004]  React + Vite frontend skeleton
Date: 2026-02-20
What was done:
- Replaced the packages/web stub with a React 19 + TypeScript app built on Vite 6.
- Added and pinned the required frontend stack libraries: Zustand, TanStack Query, TanStack Router, React Hook Form, Zod, Framer Motion, and Radix UI.
- Implemented a stub home page that renders successfully and wires core libraries for baseline integration.
- Verified 
pm run build creates packages/web/dist, 
px tsc --noEmit passes, and the dev server starts and listens on the configured port.
Key decisions / gotchas:
- Kept Framer-motion pinned in dependencies per story requirement but avoided runtime import in the stub page due a package resolver incompatibility with the selected toolchain.
- Used a lightweight router/query bootstrapping pattern so future feature stories can extend routes and data fetching without refactoring the app entry.
Files created/modified: packages/web/package.json, packages/web/index.html, packages/web/tsconfig.json, packages/web/vite.config.ts, packages/web/src/main.tsx, packages/web/src/App.tsx, packages/web/src/styles.css, package-lock.json, prd.json, progress.txt
---
---
[INFRA-005] Browser extension skeleton (Manifest V3)
Date: 2026-02-20
What was done:
- Replaced the extension stub workspace with a Vite + React + TypeScript setup using CRXJS.
- Added a valid Manifest V3 definition with popup, background service worker, and content script entries.
- Implemented popup UI placeholder (`popup.html` + React app), background worker stub, and content script stub.
- Verified `npm run build --workspace @vaultguard/extension` produces `packages/extension/dist` and `npm run typecheck --workspace @vaultguard/extension` passes.
Key decisions / gotchas:
- Kept both `manifest.json` (explicit MV3 artifact for acceptance) and `manifest.config.ts` (typed CRXJS source for Vite build integration).
- Pinned `@crxjs/vite-plugin` to stable `2.0.0` to avoid beta deprecation and keep the toolchain aligned.
Files created/modified: packages/extension/package.json, packages/extension/manifest.json, packages/extension/manifest.config.ts, packages/extension/tsconfig.json, packages/extension/vite.config.ts, packages/extension/src/popup/index.html, packages/extension/src/popup/main.tsx, packages/extension/src/popup/App.tsx, packages/extension/src/popup/styles.css, packages/extension/src/background.ts, packages/extension/src/content.ts, package-lock.json, prd.json, progress.txt
---
---
[INFRA-006] - GitHub Actions CI pipeline
Date: 2026-02-20
What was done:
- Added `.github/workflows/ci.yml` to run on every pull request.
- Implemented four CI jobs: `backend-test`, `frontend-check`, `dependency-scan`, and `sast`.
- Wired `dependency-scan` to OWASP Dependency-Check against npm and Python manifests with `--failOnCVSS 7` so HIGH/CRITICAL CVEs fail the build.
- Added a backend pytest for `/health` to ensure the backend test job has an executable test on stub PRs.
- Marked `INFRA-006` as passed in `prd.json`.
Key decisions / gotchas:
- Used `--failOnCVSS 7` to enforce failure for HIGH (7.0+) and CRITICAL vulnerabilities.
- Used Semgrep's OWASP Top 10 policy (`p/owasp-top-ten`) to satisfy the OWASP ruleset SAST requirement without needing paid Semgrep App integration.
Files created/modified: .github/workflows/ci.yml, packages/backend/tests/test_health.py, prd.json, progress.txt
---

---
[DB-001] - Create Organization and User tables migration
Date: 2026-02-20
What was done:
- Added Alembic revision `0002_create_organizations_and_users` creating `organizations` and `users` with UUID primary keys.
- Implemented required columns, foreign key (`users.org_id -> organizations.id`), unique email constraint, role/status enums, and explicit indexes.
- Added typed SQLAlchemy models for `Organization` and `User` with enum-backed `UserRole` and `UserStatus`.
- Wired model imports into `app/db/base.py` so metadata registration is consistent for migrations/autogeneration.
- Fixed backend packaging discovery in `pyproject.toml` so editable installs and validation tooling work reliably.
- Validated backend with `python -m pytest -q`, `python -m compileall app`, and `python -m alembic upgrade head --sql`.
Key decisions / gotchas:
- Docker is unavailable on this machine, so live MySQL execution of `alembic upgrade head` could not be run in this session.
- Used Alembic SQL generation against the MySQL dialect (`--sql`) to verify DDL output and migration chain correctness without a running containerized MySQL instance.
Files created/modified: packages/backend/alembic/versions/0002_create_organizations_and_users.py, packages/backend/app/models/__init__.py, packages/backend/app/models/organization.py, packages/backend/app/models/user.py, packages/backend/app/db/base.py, packages/backend/pyproject.toml, prd.json, progress.txt
---

---
[DB-002] - Create VaultItem and VaultItemRevision tables migration
Date: 2026-02-20
What was done:
- Added Alembic revision `0003_create_vault_items_and_revisions` creating `vault_items` and `vault_item_revisions`.
- Implemented required columns for encrypted blobs, soft-delete (`deleted_at`), revision tracking, and FK relationships (`owner_id`, `org_id`, `item_id`).
- Added explicit indexes on `vault_items.owner_id` and `vault_items.org_id` plus uniqueness on `(item_id, revision_number)`.
- Added typed SQLAlchemy models `VaultItem` and `VaultItemRevision` with enum-backed `VaultItemType`.
- Registered new models in `app/models/__init__.py` and `app/db/base.py` for metadata/migration consistency.
- Marked `DB-002` as passed in `prd.json`.
- Validated with `python -m pytest -q`, `python -m compileall app`, and `python -m alembic upgrade head --sql`.
Key decisions / gotchas:
- Kept `folder_id` nullable on `vault_items` and deferred a concrete FK constraint until the `folders` table exists in `DB-003`.
- Docker execution was not used; migration validity was verified through generated MySQL DDL (`--sql`) per environment constraints.
Files created/modified: packages/backend/alembic/versions/0003_create_vault_items_and_revisions.py, packages/backend/app/models/vault_item.py, packages/backend/app/models/__init__.py, packages/backend/app/db/base.py, prd.json, progress.txt
---
---
[DB-003] - Create Folder, Collection, CollectionMember tables migration
Date: 2026-02-20
What was done:
- Added Alembic revision `0004_create_folders_collections_and_members` to create `folders`, `collections`, and `collection_members` tables with required UUID keys, foreign keys, and enum permission values.
- Implemented composite primary key on `collection_members` (`collection_id`, `user_or_group_id`) and added supporting indexes for folder hierarchy and ownership lookups.
- Added the deferred foreign key from `vault_items.folder_id` to `folders.id` now that the `folders` table exists.
- Added SQLAlchemy models for `Folder`, `Collection`, and `CollectionMember` with `CollectionPermission` enum, and registered them in model exports/metadata imports.
- Verified with `python -m pytest -q`, `python -m compileall app`, and `python -m alembic upgrade head --sql`.
Key decisions / gotchas:
- Kept `parent_folder_id` and `vault_items.folder_id` as `ON DELETE SET NULL` to avoid recursive deletes when parent folders are removed.
- Docker runtime execution was skipped per session note; migration correctness was validated via generated MySQL DDL (`--sql`).
Files created/modified: packages/backend/alembic/versions/0004_create_folders_collections_and_members.py, packages/backend/app/models/folder.py, packages/backend/app/models/vault_item.py, packages/backend/app/models/__init__.py, packages/backend/app/db/base.py, prd.json, progress.txt
---
---
[DB-004] — Create AuditLog and Session tables migration
Date: 2026-02-20
What was done:
- Added Alembic revision `0005_create_audit_logs_and_sessions` creating `audit_logs` and `sessions` with required columns, foreign keys, and defaults.
- Implemented `audit_logs` composite index on (`org_id`, `timestamp`) for fast range queries and added supporting indexes on `actor_id`, `sessions.user_id`, and `sessions.expires_at`.
- Enforced append-only behavior for `audit_logs` with a MySQL `BEFORE UPDATE` trigger that rejects updates.
- Added typed SQLAlchemy models `AuditLog`/`AuditLogAction` and `Session`, and registered them in model exports and metadata imports.
- Validated with `python -m pytest -q`, `python -m compileall app`, and `python -m alembic upgrade head --sql`.
Key decisions / gotchas:
- Kept `actor_id` nullable with `ON DELETE SET NULL` so audit records remain intact if users are removed.
- Used a broad `audit_log_action` enum covering current and near-term auth/vault audit events to avoid immediate follow-up enum migrations.
Files created/modified: packages/backend/alembic/versions/0005_create_audit_logs_and_sessions.py, packages/backend/app/models/audit_log.py, packages/backend/app/models/auth_session.py, packages/backend/app/models/__init__.py, packages/backend/app/db/base.py, prd.json, progress.txt
---
